<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Administrativo - Biblioteca Online</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .dashboard-header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            color: white;
            text-align: center;
        }
        
        .stats-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
        }
        
        .stats-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            margin-bottom: 1rem;
        }
        
        .stats-number {
            font-size: 2rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }
        
        .stats-label {
            color: #7f8c8d;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .section-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .admin-nav {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1rem;
            margin-bottom: 2rem;
        }
        
        .admin-nav .nav-link {
            color: white;
            border-radius: 10px;
            margin: 0 0.25rem;
            transition: all 0.3s ease;
        }
        
        .admin-nav .nav-link:hover,
        .admin-nav .nav-link.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }
        
        .action-card {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            text-decoration: none;
            transition: transform 0.3s ease;
            text-align: center;
        }
        
        .action-card:hover {
            transform: translateY(-5px);
            color: white;
            text-decoration: none;
        }
        
        .action-card.books {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }
        
        .action-card.users {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }
        
        .action-card.loans {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }
        
        .action-card.reports {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }
        
        .profile-section {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid white;
        }
        
        .admin-badge {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .recent-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-left: 4px solid #3498db;
        }
        
        .role-badge {
            font-size: 0.8rem;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark" style="background: rgba(255,255,255,0.1); backdrop-filter: blur(10px);">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/">
                <i class="fas fa-book-open me-2"></i>
                Biblioteca Online
            </a>
            
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">
                    <i class="fas fa-home me-1"></i>In√≠cio
                </a>
                <a class="nav-link" href="/books">
                    <i class="fas fa-book me-1"></i>Cat√°logo
                </a>
                <a class="nav-link" href="/profile">
                    <i class="fas fa-user me-1"></i>Perfil
                </a>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Dashboard Header -->
        <div class="dashboard-header">
            <div class="row align-items-center">
                <div class="col-md-3">
                    <img th:src="${user.profileImage != null ? user.profileImage : '/static/images/default-avatar.png'}" 
                         alt="Profile" class="profile-avatar">
                </div>
                <div class="col-md-9 text-md-start">
                    <h1 class="display-5 fw-bold mb-2">
                        Painel Administrativo üõ°Ô∏è
                    </h1>
                    <p class="lead mb-3">
                        Bem-vindo, <span th:text="${user.name}">Administrador</span>! Gerencie todo o sistema da biblioteca.
                    </p>
                    <span class="admin-badge">
                        <i class="fas fa-shield-alt"></i>
                        Administrador
                    </span>
                </div>
            </div>
        </div>

        <!-- Admin Navigation -->
        <div class="admin-nav">
            <ul class="nav nav-pills justify-content-center">
                <li class="nav-item">
                    <a class="nav-link active" href="/admin/dashboard">
                        <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/admin/users">
                        <i class="fas fa-users me-1"></i>Usu√°rios
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/admin/books">
                        <i class="fas fa-book me-1"></i>Livros
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/admin/loans">
                        <i class="fas fa-handshake me-1"></i>Empr√©stimos
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/admin/reports">
                        <i class="fas fa-chart-bar me-1"></i>Relat√≥rios
                    </a>
                </li>
            </ul>
        </div>

        <!-- Statistics Cards -->
        <div class="row g-4 mb-4">
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <div class="stats-icon bg-primary mx-auto">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="stats-number" th:text="${totalBooks}">0</div>
                    <div class="stats-label">Total de Livros</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <div class="stats-icon bg-success mx-auto">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stats-number" th:text="${totalUsers}">0</div>
                    <div class="stats-label">Usu√°rios Cadastrados</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <div class="stats-icon bg-warning mx-auto">
                        <i class="fas fa-handshake"></i>
                    </div>
                    <div class="stats-number" th:text="${activeLoans}">0</div>
                    <div class="stats-label">Empr√©stimos Ativos</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <div class="stats-icon bg-info mx-auto">
                        <i class="fas fa-history"></i>
                    </div>
                    <div class="stats-number" th:text="${totalLoans}">0</div>
                    <div class="stats-label">Total de Empr√©stimos</div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Recent Activity -->
            <div class="col-lg-8">
                <div class="section-card">
                    <h3 class="mb-4">
                        <i class="fas fa-clock me-2 text-primary"></i>
                        Atividade Recente
                    </h3>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h5 class="mb-3">Livros Recentes</h5>
                            <div th:if="${recentBooks.empty}" class="text-muted">
                                Nenhum livro cadastrado recentemente.
                            </div>
                            <div th:unless="${recentBooks.empty}">
                                <div class="recent-item" th:each="book : ${recentBooks}">
                                    <h6 class="mb-1" th:text="${book.title}">T√≠tulo</h6>
                                    <small class="text-muted" th:text="${book.author}">Autor</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <h5 class="mb-3">Usu√°rios Recentes</h5>
                            <div th:if="${recentUsers.empty}" class="text-muted">
                                Nenhum usu√°rio cadastrado recentemente.
                            </div>
                            <div th:unless="${recentUsers.empty}">
                                <div class="recent-item" th:each="user : ${recentUsers}">
                                    <h6 class="mb-1" th:text="${user.name}">Nome</h6>
                                    <small class="text-muted">
                                        <span th:text="${user.email}">Email</span>
                                        <span class="role-badge ms-2" 
                                              th:classappend="${user.role.name() == 'ADMIN' ? 'bg-danger text-white' : (user.role.name() == 'AUTHOR' ? 'bg-warning text-dark' : 'bg-success text-white')}"
                                              th:text="${user.role.displayName}">Role</span>
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Overview -->
            <div class="col-lg-4">
                <!-- User Distribution -->
                <div class="section-card">
                    <h5 class="mb-3">
                        <i class="fas fa-chart-pie me-2 text-success"></i>
                        Distribui√ß√£o de Usu√°rios
                    </h5>
                    
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="small">Leitores</span>
                            <span class="badge bg-success" th:text="${readers.size()}">0</span>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-success" 
                                 th:style="'width: ' + (${totalUsers > 0 ? (readers.size() * 100.0 / totalUsers) : 0}) + '%'"></div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="small">Autores</span>
                            <span class="badge bg-warning" th:text="${authors.size()}">0</span>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-warning" 
                                 th:style="'width: ' + (${totalUsers > 0 ? (authors.size() * 100.0 / totalUsers) : 0}) + '%'"></div>
                        </div>
                    </div>
                    
                    <div class="mb-0">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="small">Administradores</span>
                            <span class="badge bg-danger" th:text="${admins.size()}">0</span>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-danger" 
                                 th:style="'width: ' + (${totalUsers > 0 ? (admins.size() * 100.0 / totalUsers) : 0}) + '%'"></div>
                        </div>
                    </div>
                </div>

                <!-- System Status -->
                <div class="section-card">
                    <h5 class="mb-3">
                        <i class="fas fa-server me-2 text-info"></i>
                        Status do Sistema
                    </h5>
                    
                    <div class="mb-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="small">Sistema</span>
                            <span class="badge bg-success">Online</span>
                        </div>
                    </div>
                    
                    <div class="mb-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="small">Banco de Dados</span>
                            <span class="badge bg-success">Conectado</span>
                        </div>
                    </div>
                    
                    <div class="mb-0">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="small">√öltima Atualiza√ß√£o</span>
                            <span class="small text-muted">Agora</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <a href="/admin/users" class="action-card users">
                <i class="fas fa-users fa-2x mb-2"></i>
                <h6>Gerenciar Usu√°rios</h6>
                <p class="small mb-0">Visualizar e gerenciar contas</p>
            </a>
            
            <a href="/admin/books" class="action-card books">
                <i class="fas fa-book fa-2x mb-2"></i>
                <h6>Gerenciar Livros</h6>
                <p class="small mb-0">Controlar cat√°logo de livros</p>
            </a>
            
            <a href="/admin/loans" class="action-card loans">
                <i class="fas fa-handshake fa-2x mb-2"></i>
                <h6>Gerenciar Empr√©stimos</h6>
                <p class="small mb-0">Controlar empr√©stimos ativos</p>
            </a>
            
            <a href="/admin/reports" class="action-card reports">
                <i class="fas fa-chart-bar fa-2x mb-2"></i>
                <h6>Relat√≥rios</h6>
                <p class="small mb-0">Visualizar estat√≠sticas detalhadas</p>
            </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
